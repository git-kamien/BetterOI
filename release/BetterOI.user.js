// ==UserScript==
// @name         BetterOI
// @namespace    ...
// @version      1.0.0
// @description  Yeah, such a good tool deserves to be even better!
// @author       KamieÅ„
// @match        https://osint.industries/email
// @match        https://osint.industries/
// @grant        none
// ==/UserScript==

(()=>{"use strict";const e=(e,n)=>n.some((n=>e instanceof n));let n,t;const i=new WeakMap,o=new WeakMap,r=new WeakMap,s=new WeakMap,a=new WeakMap;let c={get(e,n,t){if(e instanceof IDBTransaction){if("done"===n)return o.get(e);if("objectStoreNames"===n)return e.objectStoreNames||r.get(e);if("store"===n)return t.objectStoreNames[1]?void 0:t.objectStore(t.objectStoreNames[0])}return l(e[n])},set:(e,n,t)=>(e[n]=t,!0),has:(e,n)=>e instanceof IDBTransaction&&("done"===n||"store"===n)||n in e};function d(s){return"function"==typeof s?(a=s)!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(t||(t=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(a)?function(...e){return a.apply(u(this),e),l(i.get(this))}:function(...e){return l(a.apply(u(this),e))}:function(e,...n){const t=a.call(u(this),e,...n);return r.set(t,e.sort?e.sort():[e]),l(t)}:(s instanceof IDBTransaction&&function(e){if(o.has(e))return;const n=new Promise(((n,t)=>{const i=()=>{e.removeEventListener("complete",o),e.removeEventListener("error",r),e.removeEventListener("abort",r)},o=()=>{n(),i()},r=()=>{t(e.error||new DOMException("AbortError","AbortError")),i()};e.addEventListener("complete",o),e.addEventListener("error",r),e.addEventListener("abort",r)}));o.set(e,n)}(s),e(s,n||(n=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction]))?new Proxy(s,c):s);var a}function l(e){if(e instanceof IDBRequest)return function(e){const n=new Promise(((n,t)=>{const i=()=>{e.removeEventListener("success",o),e.removeEventListener("error",r)},o=()=>{n(l(e.result)),i()},r=()=>{t(e.error),i()};e.addEventListener("success",o),e.addEventListener("error",r)}));return n.then((n=>{n instanceof IDBCursor&&i.set(n,e)})).catch((()=>{})),a.set(n,e),n}(e);if(s.has(e))return s.get(e);const n=d(e);return n!==e&&(s.set(e,n),a.set(n,e)),n}const u=e=>a.get(e),m=["get","getKey","getAll","getAllKeys","count"],h=["put","add","delete","clear"],p=new Map;function b(e,n){if(!(e instanceof IDBDatabase)||n in e||"string"!=typeof n)return;if(p.get(n))return p.get(n);const t=n.replace(/FromIndex$/,""),i=n!==t,o=h.includes(t);if(!(t in(i?IDBIndex:IDBObjectStore).prototype)||!o&&!m.includes(t))return;const r=async function(e,...n){const r=this.transaction(e,o?"readwrite":"readonly");let s=r.store;return i&&(s=s.index(n.shift())),(await Promise.all([s[t](...n),o&&r.done]))[0]};return p.set(n,r),r}var y,v;v=c,c={...v,get:(e,n,t)=>b(e,n)||v.get(e,n,t),has:(e,n)=>!!b(e,n)||v.has(e,n)},function(e){let n,t;n=e.typings||(e.typings={}),function(e){async function n(){return await function(e,n,{blocked:t,upgrade:i,blocking:o,terminated:r}={}){const s=indexedDB.open(e,n),a=l(s);return i&&s.addEventListener("upgradeneeded",(e=>{i(l(s.result),e.oldVersion,e.newVersion,l(s.transaction),e)})),t&&s.addEventListener("blocked",(e=>t(e.oldVersion,e.newVersion,e))),a.then((e=>{r&&e.addEventListener("close",(()=>r())),o&&e.addEventListener("versionchange",(e=>o(e.oldVersion,e.newVersion,e)))})).catch((()=>{})),a}("osint_history",1,{upgrade(e){const n=e.createObjectStore("archive",{keyPath:"tid"});n.createIndex("by_query","query"),n.createIndex("by_tid","tid")}})}e.open_history_db=n,e.archive_snapshot=async function(e){const t=await n(),i=(new Date).getTime().toString(16);return t.add("archive",{...e,tid:i})},e.query_snapshots=async function(e){const t=await n();return(await t.getAllFromIndex("archive","by_query",e)).sort(((e,n)=>{const t=new Date(+`0x${e.tid}`),i=new Date(+`0x${n.tid}`);return Number(i)-Number(t)}))},e.query_snapshot=async function(e){const t=await n();return await t.getFromIndex("archive","by_tid",e)}}(t=e.methods||(e.methods={}))}(y||(y={}));const g=window;var f,_;!function(e){let n;!function(e){function n(){return+document.querySelector("img[src*='coin.svg']").previousElementSibling.innerText}function t(){const e=document.querySelector("img[src*='coin.svg']").previousElementSibling;e.innerText=""+(+e.innerText-1)}function i(){document.querySelector(".boi_results").style.removeProperty("display")}function o(){document.querySelector(".boi_results").style.setProperty("display","none")}async function r(e){const n=document.querySelector(".boi_search > .history"),t=n.querySelector("[role='amount_indicator']"),r=document.querySelector(".boi_search > .enter_query");e&&i(),n.options.selectedIndex=e||0,n.querySelectorAll("option:not([role='amount_indicator'])").forEach((e=>e.remove()));const s=await y.methods.query_snapshots(r.value);if(!s.length)return o(),t.innerText="No history snapshots",void n.setAttribute("disabled","");const a=e=>`${e.getHours().toString().padStart(2,"0")}:${e.getMinutes().toString().padStart(2,"0")}`;t.innerText=`Available: ${s.length} history snapshots`;for(const e of Object.values(s)){const t=new Date(+`0x${e.tid}`),i=document.createElement("option");i.setAttribute("tid",e.tid),i.innerText=`${c=t,`${c.getFullYear()}.${(c.getMonth()+1).toString().padStart(2,"0")}.${c.getDate().toString().padStart(2,"0")}`} | ${a(t)} | ${e.snapshot.length} entries`,n.appendChild(i)}var c;n.removeAttribute("disabled")}function s(e){document.querySelector(".boi_results > #mirror").outerHTML='<div id="mirror" style="display: none"></div>',document.querySelector(".boi_results > #map").outerHTML='<div id="map" style="display: none"></div>';const n=document.querySelector(".boi_results > #mirror"),t=document.querySelector(".boi_results > #map");let i=[],o=[],r={listing:[],reviews_from_guest:[]};return e.forEach((e=>{"google"==e.module&&e.data.advanced_data.m&&(i=e.data.advanced_data.m.photos.concat(e.data.advanced_data.m.reviews)),"strava"==e.module&&(o=e.data.advanced_location),"airbnb"==e.module&&(r=e.data.loc)})),(i.length||o.length||r.listing.length||r.reviews_from_guest.length)&&(t.style.display="block",g.initMap(i,o,r)),n.style.display="block",g.monaco.editor.create(n,{scrollBeyondLastLine:!1,automaticLayout:!0,language:"json",readOnly:!0,minimap:{enabled:!1},theme:"vs-dark",value:JSON.stringify(e,null,2)}),!0}function a(){const e=document.querySelector("#main"),n=document.querySelector("#footer"),[t,i]=e.children,o=document.createElement("div");if(o.classList.add("boi_bottom"),o.append(i),o.append(n),e.appendChild(o),!document.querySelector("a[href='/login']"))return t.innerHTML='\n        <section class="shock-section pt-5 pb-5">\n          <div class="container">\n            <div class="boi_search">\n              <input class="item_overlay enter_query" type="text" placeholder="Search for email or phone number">\n              <select class="item_overlay history form-select" disabled>\n                <option role="amount_indicator" selected disabled>No history snapshots</option>\n              </select>\n              <div class="submitter">\n                <button class="item_overlay new_snapshot" type="submit" disabled>You have to accept the rules</button>\n                <div class="accept_tos">\n                  <input id="tos" class="form-check-input" type="checkbox" required>\n                  <label for="tos">\n                    I agree to the <a href="/terms" class="link purple primary-hover"><u>terms of use</u>.</a>\n                  </label>\n                </div>\n              </div>\n              <div class="hcaptcha_renderer"></div>\n            </div>\n            <div class="boi_results" style="display: none">\n              <div id="map"></div> \n              <div id="mirror"></div>\n            </div>\n          </div>\n        </section>\n      ',!0;t.innerHTML='\n          <div class="boi_section">\n            <h1>Login to your account to use the service</h1>\n          </div>\n        '}e.get_credits=n,e.decrement_credit=t,e.show_results=i,e.hide_results=o,e.update_history=r,e.render_snapshot=s,e.build_ui=a,e.initialize=function(e){a();const o=document.querySelector(".boi_search > .hcaptcha_renderer"),c=g.hcaptcha.render(o,{theme:"dark",sitekey:e}),d=document.querySelector(".boi_search > .submitter > .new_snapshot"),l=document.querySelector(".boi_search > .enter_query"),u=document.querySelector(".boi_search > .history"),m=document.querySelector(".boi_search > .submitter > .accept_tos > #tos");async function h(e){t(),d.innerText="Making snapshot...";const n=await fetch("https://osint.industries/email",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({query:l.value,terms:"on","g-recaptcha-response":e.response,"h-captcha-response":e.response})}),i=await n.text(),o=[...(new DOMParser).parseFromString(i,"text/html").body.querySelectorAll("script")].find((e=>e.innerHTML.includes("jsonData"))),[a]=o.innerHTML.match(/(?<=const jsonData = )(.*)(?=;)/gm),c=JSON.parse(a);await y.methods.archive_snapshot({snapshot:c,query:l.value}),await r(1),s(c),d.innerText="Make new snapshot (-1 credit)",d.removeAttribute("disabled"),m.removeAttribute("disabled")}function p(){d.innerText="Make new snapshot (-1 credit)",d.removeAttribute("disabled"),m.removeAttribute("disabled")}const b=g.Swal.mixin({showConfirmButton:!1,timerProgressBar:!0,position:"top-end",timer:2500,toast:!0});l.addEventListener("input",(async function(){return await r()})),u.addEventListener("change",(async function(){const e=u.options[u.options.selectedIndex].getAttribute("tid"),{snapshot:n}=await y.methods.query_snapshot(e);i(),s(n)})),d.addEventListener("click",(function(){if(n()<=0)return b.fire({icon:"error",title:"You don't have enough credits"});d.innerText="Waiting for captcha...",d.setAttribute("disabled",""),m.setAttribute("disabled",""),g.hcaptcha.execute(c,{async:!0}).then(h).catch(p)})),m.addEventListener("change",(function(){if(m.checked)return d.innerText="Make new snapshot (-1 credit)",void d.removeAttribute("disabled");d.innerText="You have to accept the rules",d.setAttribute("disabled","")}))}}(n=e.methods||(e.methods={}))}(f||(f={})),function(e){let n;e.stylesheet='\n    .swal2-popup {\n      background: hsl(0deg, 0%, 20%) !important;\n      color: white !important;\n    }\n    #main {\n      flex-direction: column;\n      display: flex;\n      height: 100vh;\n    }\n    #footer {\n      z-index: 9999;\n    }\n    .boi_search {\n      margin-top: 5rem;\n      display: flex;\n    }\n    .boi_search .item_overlay {\n      background: hsl(0deg, 0%, 20%);\n      font-size: 0.875rem;\n      max-width: 15.625rem;\n      min-width: 15.625rem;\n    }\n    .boi_search > .hcaptcha_renderer {\n      pointer-events: none;\n      opacity: 0;\n    }\n    .boi_search > .enter_query {\n      border-radius: 8px;\n      text-align: center;\n      position: relative;\n      height: 45px;\n      border: none;\n      color: white;\n    }\n    .boi_search > .history {\n      margin-left: 1.25rem;\n      position: relative;\n      height: 2.8rem;\n      border: none;\n      color: white;\n    }\n    .boi_search > .submitter {\n      flex-direction: column;\n      margin-left: 1.25rem;\n      text-align: center;\n      display: flex;\n      gap: 0.313rem;\n    }\n    .boi_search > .submitter > .new_snapshot:not(:disabled):hover {\n      background: hsl(0deg, 0%, 25%)\n    }\n    .boi_search > .submitter > .new_snapshot {\n      border-radius: 0.5rem;\n      height: 2.813rem;\n      border: none;\n      color: white;\n    }\n    .boi_search > .submitter > .accept_tos {\n      justify-content: center;\n      user-select: none;\n      display: flex;\n      gap: 0.625rem;\n    }\n\n    .boi_bottom {\n      justify-content: flex-end;\n      flex-direction: column;\n      display: flex;\n      height: 100%;\n      width: 100%;\n    }\n\n    .boi_results {\n      flex-direction: column;\n      margin-top: 3rem;\n      display: flex;\n      gap: 3rem;\n    }\n    .boi_results > #map,\n    .boi_results > #mirror {\n      height: 40rem;\n    }\n\n    @keyframes spin_keyframes {\n      0% {\n        opacity: 1;\n      }\n      100% {\n        opacity: 0;\n      }\n    }\n    .boi_section {\n      justify-content: center;\n      flex-direction: column;\n      align-items: center;\n      display: flex; \n      height: 35.625rem; \n      width: 100%;\n      color: white;\n    }\n    .boi_loading {\n      height: 5rem;\n      width: 5rem;\n    }\n    .boi_loading > .line {\n      transform-origin: 40px 40px;\n      animation: spin_keyframes 1.2s linear infinite;\n    }\n    .boi_loading > .line:after {\n      background: gold;\n      position: absolute;\n      content: "";\n      height: 1.25rem;\n      width: 0.25rem;\n      left: 2.45rem;\n      top: 0.25rem;\n    }\n    .boi_loading > .line:nth-child(1) {\n      transform: rotate(0deg);\n      animation-delay: -1.1s;\n    }\n    .boi_loading > .line:nth-child(2) {\n      transform: rotate(30deg);\n      animation-delay: -1.0s;\n    }\n    .boi_loading > .line:nth-child(3) {\n      transform: rotate(60deg);\n      animation-delay: -0.9s;\n    }\n    .boi_loading > .line:nth-child(4) {\n      transform: rotate(90deg);\n      animation-delay: -0.8s;\n    }\n    .boi_loading > .line:nth-child(5) {\n      transform: rotate(120deg);\n      animation-delay: -0.7s;\n    }\n    .boi_loading > .line:nth-child(6) {\n      transform: rotate(150deg);\n      animation-delay: -0.6s;\n    }\n    .boi_loading > .line:nth-child(7) {\n      transform: rotate(180deg);\n      animation-delay: -0.5s;\n    }\n    .boi_loading > .line:nth-child(8) {\n      transform: rotate(210deg);\n      animation-delay: -0.4s;\n    }\n    .boi_loading > .line:nth-child(9) {\n      transform: rotate(240deg);\n      animation-delay: -0.3s;\n    }\n    .boi_loading > .line:nth-child(10) {\n      transform: rotate(270deg);\n      animation-delay: -0.2s;\n    }\n    .boi_loading > .line:nth-child(11) {\n      transform: rotate(300deg);\n      animation-delay: -0.1s;\n    }\n    .boi_loading > .line:nth-child(12) {\n      transform: rotate(330deg);\n      animation-delay: 0s\n    }\n\n    .swal2-popup {\n      background: hsl(0deg, 0%, 20%) !important;\n      color: white !important;\n    }\n  ',function(e){e.run_monaco_editor=function(e){const n=window,t=document.createElement("link");t.setAttribute("data-name","vs/editor/editor.main"),t.href="https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.41.0/min/vs/editor/editor.main.min.css",t.rel="stylesheet",document.head.appendChild(t);const i=document.createElement("script");i.onload=function(){n.MonacoEnvironment={getWorkerUrl:function(){return`data:text/javascript;charset=utf-8,${encodeURIComponent("\n              self.MonacoEnvironment = {\n                baseUrl: 'https://unpkg.com/monaco-editor@latest/min/'\n              };\n              importScripts('https://unpkg.com/monaco-editor@latest/min/vs/base/worker/workerMain.js');")}`}},n.require.config({paths:{vs:"https://unpkg.com/monaco-editor@latest/min/vs"}}),n.require(["vs/editor/editor.main"],e)},i.src="https://unpkg.com/monaco-editor@latest/min/vs/loader.js",document.head.appendChild(i)},e.run_sweet_alert2=function(){const e=document.createElement("link");e.href="https://cdn.jsdelivr.net/npm/sweetalert2@11.7.27/dist/sweetalert2.min.css",e.rel="stylesheet";const n=document.createElement("script");n.src="https://cdn.jsdelivr.net/npm/sweetalert2@11.7.27/dist/sweetalert2.all.min.js",document.head.appendChild(e),document.head.appendChild(n)},e.run_map=function(){const e=document.createElement("script");e.src="https://osint.industries/assets/js/map.js",document.head.appendChild(e)}}(n=e.Installators||(e.Installators={})),e.runner=function t(){const i=window,o=document.querySelector(".banner");if(o.getAttribute("boi_injected")||(o.setAttribute("boi_injected","true"),o.innerHTML='\n        <div class="boi_section">\n          <div class="boi_loading">\n            <div class="line"></div>\n            <div class="line"></div>\n            <div class="line"></div>\n            <div class="line"></div>\n            <div class="line"></div>\n            <div class="line"></div>\n            <div class="line"></div>\n            <div class="line"></div>\n            <div class="line"></div>\n            <div class="line"></div>\n            <div class="line"></div>\n            <div class="line"></div>\n          </div>\n          <span>Loading BetterOI</span>\n        </div>\n      '),!i.L)return setTimeout(t,100);const r=new Blob([e.stylesheet],{type:"text/css"}),s=document.createElement("link");s.href=URL.createObjectURL(r),s.rel="stylesheet",document.head.appendChild(s),n.run_map(),n.run_sweet_alert2(),n.run_monaco_editor((function e(){return i.swal?f.methods.initialize("4a228ca4-461e-4b4d-a3c2-dd6860ee946e"):setTimeout(e,100)}))}}(_||(_={})),_.runner()})();
